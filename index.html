<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connectivity Checker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2ecc71;
            --danger: #e74c3c;
            --success: #2ecc71;
            --light: #FFFFFF;
            --dark: #34495e;
            --bg: #ecf0f1;
            --border: #bdc3c7;
            --highlight: #d6eaf8;
            --text: #2c3e50;
            --card-bg: #FFFFFF;
            --table-header-bg: rgba(52, 152, 219, 0.1);
            --table-row-bg: #FFFFFF;
            --open-color: #2ecc71;
            --closed-color: #e74c3c;
        }

        .dark-mode {
            --primary: #3498db;
            --secondary: #2ecc71;
            --danger: #e74c3c;
            --success: #2ecc71;
            --light: #2c3e50;
            --dark: #ecf0f1;
            --bg: #1a1a1a;
            --border: #34495e;
            --highlight: #2c3e50;
            --text: #ecf0f1;
            --card-bg: #2c3e50;
            --table-header-bg: rgba(52, 152, 219, 0.2);
            --table-row-bg: #34495e;
            --open-color: #27ae60;
            --closed-color: #c0392b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
            transition: all 0.3s ease;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
            width: 100%;
            max-width: 1400px;
        }

        .header h1 {
            color: var(--primary);
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .header p {
            color: var(--text);
            opacity: 0.8;
            font-size: 1rem;
        }

        .tool-container {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 1400px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .input-section {
            display: flex;
            gap: 2rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .input-box {
            flex: 1;
            min-width: 300px;
        }

        .input-box h3 {
            margin-bottom: 0.5rem;
            color: var(--dark);
            font-size: 1.1rem;
        }

        .paste-container {
            position: relative;
            width: 100%;
            margin-bottom: 1rem;
        }

        .paste-area {
            width: 100%;
            height: 200px;
            max-height: 300px;
            padding: 1rem;
            border: 2px dashed var(--border);
            border-radius: 8px;
            font-family: monospace;
            overflow-y: auto;
            resize: vertical;
            background-color: var(--card-bg);
            color: var(--text);
            transition: all 0.3s ease;
        }

        .paste-area:focus {
            outline: none;
            border-color: var(--primary);
        }

        .paste-icon {
            position: absolute;
            right: 10px;
            top: 10px;
            background: var(--primary);
            color: white;
            padding: 5px 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .paste-icon:hover {
            background: var(--secondary);
        }

        .toolbar {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.7rem 1.2rem;
            border-radius: 6px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-secondary {
            background: var(--border);
            color: var(--text);
        }

        .btn-secondary:hover {
            background: var(--border);
            opacity: 0.8;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #27ae60;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 1rem;
            table-layout: fixed;
            font-size: 0.85rem;
        }

        th, td {
            border: 1px solid var(--border);
            padding: 0.5rem;
            text-align: left;
            min-width: 100px;
            word-wrap: break-word;
        }

        th {
            background-color: var(--table-header-bg);
            position: sticky;
            top: 0;
            color: var(--text);
        }

        td {
            background-color: var(--table-row-bg);
            color: var(--text);
        }

        .open-status {
            background-color: rgba(46, 204, 113, 0.2);
            font-weight: 600;
            color: var(--open-color);
        }

        .closed-status {
            background-color: rgba(231, 76, 60, 0.2);
            font-weight: 600;
            color: var(--closed-color);
        }

        .copy-tick {
            position: absolute;
            right: 0px;
            top: 0px;
            background-color: rgba(0,0,0,0.5);
            border-radius: 100%;
            padding: 4px;
            color: white;
            display: none;
        }

        .btn-with-tick {
            position: relative;
        }

        footer {
            margin-top: 3rem;
            text-align: center;
            color: var(--text);
            opacity: 0.7;
            font-size: 0.9rem;
            width: 100%;
            max-width: 1400px;
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .output-toolbar {
            display: flex;
            justify-content: flex-end;
            margin-top: 1rem;
            gap: 1rem;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: var(--card-bg);
            margin: 10% auto;
            padding: 20px;
            border: 1px solid var(--border);
            border-radius: 8px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .modal-header h2 {
            color: var(--primary);
        }

        .close {
            color: var(--text);
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: var(--danger);
        }

        .modal-body {
            margin-bottom: 1rem;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        @media (max-width: 768px) {
            .input-section {
                flex-direction: column;
                gap: 1rem;
            }
            
            .toolbar {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .modal-content {
                width: 95%;
                margin: 20% auto;
            }
        }
    </style>
</head>
<body>
    <button class="theme-toggle" id="themeToggle">
        <i class="fas fa-moon"></i>
    </button>

    <div class="header">
        <h1><i class="fas fa-plug"></i> Connectivity Checker</h1>
        <p>Check which numbers are open or closed based on OBU agent IDs</p>
    </div>

    <div class="tool-container">
        <div class="input-section">
            <div class="input-box">
                <h3><i class="fas fa-database"></i> CC Record Data</h3>
                <div class="paste-container">
                    <div class="paste-area" id="ccDataArea" contenteditable="true" placeholder="Paste your CC record data here..."></div>
                    <div class="paste-icon" onclick="pasteData('ccDataArea')">
                        <i class="fas fa-paste"></i> Paste
                    </div>
                </div>
                <div class="toolbar">
                    <button class="btn btn-primary" onclick="processCCData()">
                        <i class="fas fa-cogs"></i> Process
                    </button>
                    <button class="btn btn-danger" onclick="clearCCData()">
                        <i class="fas fa-trash-alt"></i> Clear
                    </button>
                    <button class="btn btn-secondary" onclick="showEditOBIDsModal()">
                        <i class="fas fa-edit"></i> Edit OB IDs
                    </button>
                </div>
            </div>
        </div>

        <div class="toolbar">
            <button class="btn btn-success" onclick="showAddScrapModal()">
                <i class="fas fa-plus"></i> Add Scrap
            </button>
        </div>

        <div class="output-section">
            <h3>Results</h3>
            <div class="output-toolbar">
                <button class="btn btn-primary btn-with-tick" onclick="copyAllData()">
                    <i class="fas fa-copy"></i> Copy All
                    <span class="copy-tick"><i class="fas fa-check"></i></span>
                </button>
                <button class="btn btn-success btn-with-tick" onclick="copyNextNumber()">
                    <i class="fas fa-copy"></i> Copy Next
                    <span class="copy-tick"><i class="fas fa-check"></i></span>
                </button>
            </div>
            <div id="tableContainer" style="overflow-x: auto;">
                <table id="dataTable">
                    <thead>
                        <tr>
                            <th>Phone Number</th>
                            <th>Status</th>
                            <th>Remarks</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
                        <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
                        <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Add Scrap Modal -->
    <div id="addScrapModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Scrap Data</h2>
                <span class="close" onclick="closeAddScrapModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="paste-container">
                    <div class="paste-area" id="scrapDataArea" contenteditable="true" placeholder="Paste your scrap data here..."></div>
                    <div class="paste-icon" onclick="pasteData('scrapDataArea')">
                        <i class="fas fa-paste"></i> Paste
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAddScrapModal()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn btn-primary" onclick="addScrapData()">
                    <i class="fas fa-plus"></i> Add
                </button>
            </div>
        </div>
    </div>

    <!-- Edit OB IDs Modal -->
    <div id="editOBIDsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit OB Agent IDs</h2>
                <span class="close" onclick="closeEditOBIDsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="paste-container">
                    <div class="paste-area" id="obIDsArea" contenteditable="true" placeholder="Enter OB Agent IDs, one per line..."></div>
                </div>
                <p style="margin-top: 10px; font-size: 0.8rem; color: var(--text); opacity: 0.7;">
                    These IDs will be used to determine if a number is "Closed" (when agent ID is found) or "Open" (when no agent ID is found).
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="resetDefaultOBIDs()">
                    <i class="fas fa-undo"></i> Reset Default
                </button>
                <button class="btn btn-danger" onclick="closeEditOBIDsModal()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn btn-primary" onclick="saveOBIDs()">
                    <i class="fas fa-save"></i> Save
                </button>
            </div>
        </div>
    </div>

    <footer>
        Â© Workflow Tools 2025 | Data is processed in your browser only (not saved to server)
    </footer>

    <script>
        // Store processed data for later use
        let scrapData = [];
        let currentIndex = 0;
        let obAgentIDs = new Set([
            // Default OB Agent IDs
            46857, 10949, 4295, 45668, 45720, 11099, 44715, 48343, 46973, 54884, 2743, 48618, 48641, 48152, 45403, 2323, 
            48646, 4826, 11911, 44372, 4900, 47923, 47455, 48587, 54888, 3239, 2680, 48883, 47856, 46238, 48882, 46771, 
            48362, 44799, 48036, 48375, 44761, 47792, 44457, 48872, 46088, 48126, 2697, 43942, 43207, 46288, 43406, 48396, 
            2101, 54871, 48664, 48932, 48606, 2593, 11488, 44374, 2413, 43365, 44312, 46487, 42234, 48122, 43647, 45470, 
            11929, 45863, 2547, 46958, 11475, 46779, 48623, 47104, 47100, 48614, 43075, 48277, 44512, 43393, 42113, 45964, 
            46633, 48346, 42482, 3011, 44790, 2453, 42141, 2681, 2225, 43171, 49026, 48265, 48805, 46871, 46543, 46019, 
            42071, 47850, 3024, 2726, 11407, 3070, 46602, 54872, 48594, 2434, 48284, 45910, 3091, 46976, 46002, 48795, 
            47829, 48048, 11797, 44836, 5675, 48808, 44551, 48297, 44877, 4790, 47838, 46067, 2267, 49091, 48342, 42002, 
            6364, 48796, 45779, 48313, 6058, 48215, 2282, 48609, 46854, 44619, 48120, 45878, 42500, 3346, 49128, 42036, 
            4937, 46654, 43930, 45474, 54883, 43810, 48777, 48197, 11888, 46450, 43760, 43272, 49130, 45658, 48865, 48133, 
            42219, 46849, 54870, 48972, 48925, 46837, 48368, 48886, 47934, 48638, 49047, 49133, 43374, 42856, 47916, 46366, 
            46291, 44000, 48690, 44041, 45000, 47878, 44080, 44015, 2706, 48616, 49145, 48046, 46931, 46641, 48665, 49112, 
            48642, 46966, 6050, 47449, 45833, 46877, 48387, 48931, 49111, 48739, 45570, 44788, 45670, 48417, 45545, 2800, 
            48671, 48801, 4448, 48354, 47750, 46936, 43856, 2942, 3932, 47786, 48586, 48870, 42006, 44144, 4002, 48800, 
            48667, 44688, 2846, 3330, 45854, 48194, 3143, 49152, 49029, 42265, 3231, 45673, 48052, 48927, 42504, 4355, 
            49123, 48153, 42046, 2946, 48621, 43593, 48988, 44545, 45660, 48813, 48659, 48033, 4048, 45401, 46466, 42009, 
            48328, 48949, 3054, 49052, 49021, 48878, 2284, 48863, 46962, 49076, 45461, 46824, 48896, 45980, 44554, 48906, 
            48745, 4385, 43874, 44699, 44115, 48652, 48971, 43713, 4037, 48975, 3903, 49002, 42172, 49088, 49087, 2919, 
            44184, 48011, 48706, 48137, 48034, 48803, 48910, 47393, 46770, 47855, 3167, 48504, 48781, 48729, 47075, 48992, 
            45913, 4500, 42003, 48890, 46681, 48741, 4696, 47742, 44188, 47961, 47487, 48676, 47950, 49134, 48718, 48782, 
            46693, 4945, 43753, 2763, 47427, 3710, 49120, 48981, 11848, 48054, 48394, 48864, 3025, 54895, 49043, 2902, 
            48383, 46471, 49151, 48709, 48163, 48151, 48941, 2755, 49044, 3009, 49146, 46923, 45880, 48854, 47745, 49110, 
            44169, 4276, 43048, 49006, 44156, 48708, 48702, 48884, 46457, 49031, 49142, 4386, 49109, 43304, 49041, 2868, 
            49025, 49007, 47754, 44862, 49045, 48207, 47125, 45992, 49141, 43147, 49046, 5991, 46772, 4882, 49147, 48982, 
            48268, 47788, 48135, 45807, 47784, 46875, 48836, 46872, 42087, 45879, 44472, 43319, 48900, 48688, 43395, 46351, 
            49140, 49154, 48802, 6042, 48902, 49099, 49080, 48668, 2723, 48697, 48682, 48978, 48123, 47079, 49093, 48707, 
            49129, 49150, 49137, 48714, 49079, 48156, 48833, 46093, 48711, 48851, 43625, 48898, 49034, 48689, 49138, 48698, 
            49105, 48935, 49102, 49020, 49148, 48936, 47207, 49032, 48627, 48282, 49040, 47230, 48380
        ]);
        let isDarkMode = false;

        document.addEventListener('DOMContentLoaded', function() {
            // Load saved OB Agent IDs from localStorage if available
            const savedOBIDs = localStorage.getItem('obAgentIDs');
            if (savedOBIDs) {
                obAgentIDs = new Set(JSON.parse(savedOBIDs));
            }
            
            // Check for saved theme preference
            if (localStorage.getItem('darkMode') === 'enabled') {
                enableDarkMode();
            }
        });

        // Theme toggle functionality
        document.getElementById('themeToggle').addEventListener('click', function() {
            isDarkMode = !isDarkMode;
            if (isDarkMode) {
                enableDarkMode();
                localStorage.setItem('darkMode', 'enabled');
            } else {
                disableDarkMode();
                localStorage.setItem('darkMode', 'disabled');
            }
        });

        function enableDarkMode() {
            document.body.classList.add('dark-mode');
            document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
            isDarkMode = true;
        }

        function disableDarkMode() {
            document.body.classList.remove('dark-mode');
            document.getElementById('themeToggle').innerHTML = '<i class="fas fa-moon"></i>';
            isDarkMode = false;
        }

        async function pasteData(areaId) {
            try {
                const clipboardItems = await navigator.clipboard.read();
                for (const clipboardItem of clipboardItems) {
                    for (const type of clipboardItem.types) {
                        if (type === 'text/plain') {
                            const blob = await clipboardItem.getType(type);
                            const text = await blob.text();
                            
                            // Get current selection/cursor position
                            const pasteArea = document.getElementById(areaId);
                            const selection = window.getSelection();
                            const currentText = pasteArea.textContent;
                            
                            // Add separator if there's existing content
                            const separator = currentText && !currentText.endsWith('\n') ? '\n' : '';
                            
                            if (!selection.isCollapsed) {
                                // Replace selection
                                const range = selection.getRangeAt(0);
                                range.deleteContents();
                                range.insertNode(document.createTextNode(separator + text));
                            } else {
                                // Append at cursor
                                const cursorPos = selection.anchorOffset;
                                pasteArea.textContent = currentText.slice(0, cursorPos) + separator + text + currentText.slice(cursorPos);
                            }
                            
                            // Move cursor to end of pasted content
                            const range = document.createRange();
                            range.selectNodeContents(pasteArea);
                            range.collapse(false);
                            selection.removeAllRanges();
                            selection.addRange(range);
                            
                            return;
                        }
                    }
                }
                alert('No text data found in clipboard');
            } catch (err) {
                console.error('Failed to read clipboard:', err);
                document.getElementById(areaId).focus();
                alert('Please use Ctrl+V to paste your data into the input box');
            }
        }

        // Normalize phone numbers by removing all non-digit characters and leading zeros
        function normalizePhoneNumber(phone) {
            if (!phone) return '';
            // Remove all non-digit characters
            let normalized = phone.replace(/\D/g, '');
            // Remove leading zeros (but keep at least one digit)
            normalized = normalized.replace(/^0+/, '');
            return normalized || '0'; // Return '0' if empty after normalization
        }

        function showAddScrapModal() {
            document.getElementById('addScrapModal').style.display = 'block';
            document.getElementById('scrapDataArea').focus();
        }

        function closeAddScrapModal() {
            document.getElementById('addScrapModal').style.display = 'none';
        }

        function addScrapData() {
            const scrapDataText = document.getElementById('scrapDataArea').textContent.trim();
            
            if (!scrapDataText) {
                alert('Please paste scrap data before adding');
                return;
            }

            // Parse scrap data (assuming first column is phone number)
            const scrapRows = scrapDataText.split(/\r\n|\n|\r/).filter(row => row.trim() !== '');
            
            scrapData = scrapRows.map(row => {
                const columns = row.split(/\t/);
                const phoneNumber = columns[0] ? columns[0].trim() : '';
                return {
                    number: phoneNumber,
                    normalizedNumber: normalizePhoneNumber(phoneNumber),
                    status: 'Pending',
                    remarks: 'Not processed yet'
                };
            });

            // Reset current index
            currentIndex = 0;
            
            // Render the table
            renderTable(scrapData);
            
            // Close the modal and clear the textarea
            closeAddScrapModal();
            document.getElementById('scrapDataArea').textContent = '';
            
            alert(`Added ${scrapData.length} numbers from scrap data`);
        }

        function processCCData() {
            const ccDataText = document.getElementById('ccDataArea').textContent.trim();
            
            if (!ccDataText) {
                alert('Please paste CC record data before processing');
                return;
            }

            if (scrapData.length === 0) {
                alert('Please add scrap data first');
                return;
            }

            // Parse CC data to extract phone numbers and staff IDs
            const ccRows = ccDataText.split(/\r\n|\n|\r/).filter(row => row.trim() !== '');
            
            // Process each scrap data item
            scrapData.forEach(item => {
                // Find matching CC record for this number
                const matchingRecord = ccRows.find(row => {
                    // Check if row contains the normalized phone number
                    const normalizedRowNumber = normalizePhoneNumber(row);
                    return normalizedRowNumber.includes(item.normalizedNumber) || 
                           item.normalizedNumber.includes(normalizedRowNumber);
                });

                if (matchingRecord) {
                    // Extract staff ID from the matching record
                    const staffIdMatch = matchingRecord.match(/\b\d{4,5}\b/);
                    if (staffIdMatch) {
                        const staffId = parseInt(staffIdMatch[0]);
                        if (obAgentIDs.has(staffId)) {
                            item.status = 'Closed';
                            item.remarks = `OB Agent ID ${staffId} found`;
                        } else {
                            item.status = 'Open';
                            item.remarks = 'No OB Agent ID found';
                        }
                    } else {
                        item.status = 'Open';
                        item.remarks = 'No Staff ID found in record';
                    }
                } else {
                    item.status = 'Open';
                    item.remarks = 'No matching record found in CC data';
                }
            });

            // Render the updated table
            renderTable(scrapData);
            
            alert('Processing complete. Status updated for all numbers.');
        }

        function renderTable(data) {
            const table = document.getElementById('dataTable');
            const tbody = table.querySelector('tbody');
            tbody.innerHTML = '';
            
            if (data.length === 0) {
                // Add empty rows for better UI
                for (let i = 0; i < 3; i++) {
                    const row = document.createElement('tr');
                    for (let j = 0; j < 3; j++) {
                        const td = document.createElement('td');
                        td.innerHTML = '&nbsp;';
                        row.appendChild(td);
                    }
                    tbody.appendChild(row);
                }
                return;
            }
            
            data.forEach(item => {
                const row = document.createElement('tr');
                
                const numberCell = document.createElement('td');
                numberCell.textContent = item.number;
                row.appendChild(numberCell);
                
                const statusCell = document.createElement('td');
                statusCell.textContent = item.status;
                if (item.status === 'Open') {
                    statusCell.classList.add('open-status');
                } else if (item.status === 'Closed') {
                    statusCell.classList.add('closed-status');
                }
                row.appendChild(statusCell);
                
                const remarksCell = document.createElement('td');
                remarksCell.textContent = item.remarks;
                row.appendChild(remarksCell);
                
                tbody.appendChild(row);
            });
        }

        function clearCCData() {
            document.getElementById('ccDataArea').textContent = '';
        }

        function copyAllData() {
            if (scrapData.length === 0) {
                alert('No data to copy. Please add scrap data first.');
                return;
            }
            
            // Create CSV-like text
            const headers = ['Phone Number', 'Status', 'Remarks'];
            const rows = scrapData.map(item => [item.number, item.status, item.remarks]);
            
            const csvContent = [headers, ...rows].map(row => row.join('\t')).join('\n');
            
            navigator.clipboard.writeText(csvContent).then(() => {
                const tick = document.querySelector('.output-toolbar .copy-tick');
                tick.style.display = 'inline-block';
                setTimeout(() => {
                    tick.style.display = 'none';
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Failed to copy data. Please try again.');
            });
        }

        function copyNextNumber() {
            if (scrapData.length === 0) {
                alert('No data to copy. Please add scrap data first.');
                return;
            }
            
            if (currentIndex >= scrapData.length) {
                currentIndex = 0; // Reset to start
            }
            
            const numberToCopy = scrapData[currentIndex].number;
            
            navigator.clipboard.writeText(numberToCopy).then(() => {
                const tick = document.querySelectorAll('.output-toolbar .copy-tick')[1];
                tick.style.display = 'inline-block';
                setTimeout(() => {
                    tick.style.display = 'none';
                }, 2000);
                
                // Move to next number
                currentIndex++;
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Failed to copy number. Please try again.');
            });
        }

        function showEditOBIDsModal() {
            const modal = document.getElementById('editOBIDsModal');
            const obIDsArea = document.getElementById('obIDsArea');
            
            // Populate the textarea with current OB Agent IDs
            obIDsArea.textContent = Array.from(obAgentIDs).join('\n');
            
            modal.style.display = 'block';
            obIDsArea.focus();
        }

        function closeEditOBIDsModal() {
            document.getElementById('editOBIDsModal').style.display = 'none';
        }

        function resetDefaultOBIDs() {
            // Reset to default OB Agent IDs
            obAgentIDs = new Set([
                46857, 10949, 4295, 45668, 45720, 11099, 44715, 48343, 46973, 54884, 2743, 48618, 48641, 48152, 45403, 2323, 
                // ... (all the default IDs you provided)
                48380
            ]);
            
            document.getElementById('obIDsArea').textContent = Array.from(obAgentIDs).join('\n');
            alert('Default OB Agent IDs have been restored.');
        }

        function saveOBIDs() {
            const obIDsText = document.getElementById('obIDsArea').textContent.trim();
            
            if (!obIDsText) {
                alert('Please enter at least one OB Agent ID');
                return;
            }
            
            // Parse the IDs (one per line, numeric only)
            const newIDs = obIDsText.split(/\r\n|\n|\r/)
                .map(id => id.trim())
                .filter(id => /^\d+$/.test(id))
                .map(id => parseInt(id));
            
            if (newIDs.length === 0) {
                alert('No valid OB Agent IDs found. Please enter numeric IDs only.');
                return;
            }
            
            // Update the OB Agent IDs set
            obAgentIDs = new Set(newIDs);
            
            // Save to localStorage
            localStorage.setItem('obAgentIDs', JSON.stringify(Array.from(obAgentIDs)));
            
            closeEditOBIDsModal();
            alert(`Saved ${obAgentIDs.size} OB Agent IDs. They will be used for processing.`);
        }

        // Handle paste events for text areas
        document.getElementById('ccDataArea').addEventListener('paste', function(e) {
            e.preventDefault();
            const text = (e.clipboardData || window.clipboardData).getData('text');
            const selection = window.getSelection();
            const currentText = this.textContent;
            
            // Add separator if there's existing content
            const separator = currentText && !currentText.endsWith('\n') ? '\n' : '';
            
            if (!selection.isCollapsed) {
                // Replace selection
                const range = selection.getRangeAt(0);
                range.deleteContents();
                range.insertNode(document.createTextNode(separator + text));
            } else {
                // Append at cursor
                const cursorPos = selection.anchorOffset;
                this.textContent = currentText.slice(0, cursorPos) + separator + text + currentText.slice(cursorPos);
            }
            
            // Move cursor to end of pasted content
            const range = document.createRange();
            range.selectNodeContents(this);
            range.collapse(false);
            selection.removeAllRanges();
            selection.addRange(range);
        });
        
        document.getElementById('scrapDataArea').addEventListener('paste', function(e) {
            e.preventDefault();
            const text = (e.clipboardData || window.clipboardData).getData('text');
            const selection = window.getSelection();
            const currentText = this.textContent;
            
            // Add separator if there's existing content
            const separator = currentText && !currentText.endsWith('\n') ? '\n' : '';
            
            if (!selection.isCollapsed) {
                // Replace selection
                const range = selection.getRangeAt(0);
                range.deleteContents();
                range.insertNode(document.createTextNode(separator + text));
            } else {
                // Append at cursor
                const cursorPos = selection.anchorOffset;
                this.textContent = currentText.slice(0, cursorPos) + separator + text + currentText.slice(cursorPos);
            }
            
            // Move cursor to end of pasted content
            const range = document.createRange();
            range.selectNodeContents(this);
            range.collapse(false);
            selection.removeAllRanges();
            selection.addRange(range);
        });
    </script>
</body>
</html>
